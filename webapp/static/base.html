<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groupie</title>
    <link rel="stylesheet" href="/css/base.css">
</head>

<body>

    

    <div id="filter-form-container" class="filter-form-container">
        <form id="filter-form" action="/filters" method="get">
            <label>Filter by Number of Members:</label><br>
            <label><input type="checkbox" name="members" value="1">1</label><br>
            <label><input type="checkbox" name="members" value="2">2</label><br>
            <label><input type="checkbox" name="members" value="3">3</label><br>
            <label><input type="checkbox" name="members" value="4">4</label><br>
            <label><input type="checkbox" name="members" value="5">5</label><br>
            <label><input type="checkbox" name="members" value="6">6</label><br>
            <label><input type="checkbox" name="members" value="7">7</label><br>

            <label>Filter by Creation Date:</label><br>
            <div id="creation-date-range">
                <div class="slider">
                    <input type="range" id="min-date" name="minCreationDate" min="1900" max="2000" value="1900" oninput="updateValue()">
                    <input type="range" id="max-date" name="maxCreationDate" min="2000" max="2099" value="2099" oninput="updateValue()">
                </div>
                <div class="date-range">
                    <span id="date-range-values">1900 - 2099</span>
                </div>
            </div>
            <br>


            <label>Filter by First Album Date:</label><br>
            <input type="date" name="firstAlbumDate"><br>


            <label>Filter by Location:</label><br>
            <select name="locations" id="location">
                {{ range . }}
                {{range .Locations}}
                <option value="{{.}}">{{.}}</option>
                {{end}}
                {{ end}}
                <option value="none" selected>None</option>
            </select>
            
            <button type="submit">Apply Filters</button>

          
        </form> 
        
    </div>

    <div class="cool-header">
        <a href="/" title="Back to Home Page">
            <h1>Groupie Tracker</h1>
        </a>
        <button id="toggle-filters" class="toggle-filters">Toggle Filters</button>
    </div>

    

    <div class="artists-container">
        {{range .}}
        <a href="/details?id={{.Id}}" class="artist-card">
            <div class="artist-image">
                <img src="{{.Image}}" alt="{{.Name}}">
            </div>
            <div class="artist-info">
                {{.Name}}
            </div>
        </a>
        {{end}}
    </div>

    <script>
        function updateValue() {
            const minDate = document.getElementById('min-date');
            const maxDate = document.getElementById('max-date');
            const dateRangeValues = document.getElementById('date-range-values');
            
            dateRangeValues.textContent = `${minDate.value} - ${maxDate.value}`;
        }
    
        document.addEventListener('DOMContentLoaded', function() {
            const filterFormContainer = document.getElementById('filter-form-container');
            const toggleFiltersButton = document.getElementById('toggle-filters');
            const coolHeader = document.querySelector('.cool-header');
    
            toggleFiltersButton.addEventListener('click', function(e) {
                e.stopPropagation(); // Prevent this click from being detected by the click-outside listener
                const isOpen = filterFormContainer.classList.toggle('open');
            });
    
            document.addEventListener('click', function(e) {
                if (!filterFormContainer.contains(e.target) && !toggleFiltersButton.contains(e.target)) {
                    filterFormContainer.classList.remove('open');
                }
            });
             const form = document.getElementById('filter-form');

        // Function to update the values display
        function updateValue() {
            const minDate = document.getElementById('min-date');
            const maxDate = document.getElementById('max-date');
            const dateRangeValues = document.getElementById('date-range-values');
            dateRangeValues.textContent = `${minDate.value} - ${maxDate.value}`;
        }

        // Load saved filters from Local Storage
        function loadFilters() {
            const savedFormData = JSON.parse(localStorage.getItem('formData'));
            
            if(savedFormData) { 
                Object.keys(savedFormData).forEach(key => {
                    const element = document.getElementsByName(key)[0];

                    if (element) {
                        switch(element.type) {
                            case 'checkbox':
                                element.checked = savedFormData[key] === "true";
                                break;
                            default:
                                element.value = savedFormData[key];
                        }
                    }
                });
                updateValue();
            }
        }

        // Save current filters to Local Storage
        form.addEventListener('submit', function() {
            const formData = new FormData(form);
            const savedFormData = {};

            formData.forEach((value, key) => {
                if (savedFormData[key]) {
                    savedFormData[key] = Array.isArray(savedFormData[key]) 
                        ? [...savedFormData[key], value] 
                        : [savedFormData[key], value];
                } else {
                    savedFormData[key] = value;
                }
            });

            localStorage.setItem('formData', JSON.stringify(savedFormData));
        });

        // Initial call to set displayed values and load saved filters
        updateValue();
        loadFilters();
        });
    </script>
    
</body>

</html>
